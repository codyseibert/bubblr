<!doctype html>

<html lang="en" data-framework="angularjs">
    <head>
        <meta charset="utf-8" />
            <title>MINI APP</title>
            <link rel="stylesheet" href="bower_components/foundation/css/foundation.css" />
            <link rel="stylesheet" href="css/app.css" />

            <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <style>[ng-cloak] { display: none; }</style>
    </head>

    <body ng-app="MINIAPP">

        <div class="row">
            <div class="center small12 columns">
                <div class="mainview-animation"
                     ng-view
                     autoscroll="true"></div>
            </div>
        </div>

        <!-- bower:js -->
        <script src="bower_components/modernizr/modernizr.js"></script>
        <script src="bower_components/jquery/dist/jquery.js"></script>
        <script src="bower_components/angular/angular.js"></script>
        <script src="bower_components/angular-cookies/angular-cookies.js"></script>
        <script src="bower_components/angular-route/angular-route.js"></script>
        <script src="bower_components/fastclick/lib/fastclick.js"></script>
        <script src="bower_components/jquery.cookie/jquery.cookie.js"></script>
        <script src="bower_components/jquery-placeholder/jquery.placeholder.js"></script>
        <script src="bower_components/foundation/js/foundation.js"></script>
        <script src="bower_components/angular-animate/angular-animate.js"></script>
        <script src="bower_components/angular-foundation/mm-foundation-tpls.js"></script>
        <script src="bower_components/d3/d3.js"></script>
        <!-- endbower -->

        <script src="js/app.js"></script>


        <script>
            var width = 960,
                height = 1000;

            var force,
                drag,
                svg,
                link,
                node,
                dragstart,
                dragend,
                dblclick;

            force = d3.layout.force()
                .size([width, height])
                .charge(-1000)
                .linkDistance(400)
                .on("tick", tick);

            drag = force.drag()
            .on("dragstart", dragstart)
            .on("dragend", dragend);

            svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

            link = svg.selectAll(".link");

            node = svg.selectAll(".node");

            dragstart = function (d) {
                d3.select(this).classed("fixed", d.fixed = true);
            }

            dragend = function (d) {
                d3.select(this).classed("fixed", d.fixed = false);
            }

            dblclick = function (d) {
                d3.select(this).classed("fixed", d.fixed = false);
            }


            // UPDATE FUNCTIONS
            function tick() {
                link.attr("x1", function(d) { return d.source.x; })
                .attr("y1", function(d) { return d.source.y; })
                .attr("x2", function(d) { return d.target.x; })
                .attr("y2", function(d) { return d.target.y; });

                node.attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; });
            }

            // INITIALIZE D3
            d3.json("graph.json", function(error, graph) {
                force
                .nodes(graph.nodes)
                .links(graph.links)
                .start();

                link = link.data(graph.links)
                .enter().append("line")
                .attr("class", "link");

                node = node.data(graph.nodes)
                .enter().append("circle")
                .attr("class", "node")
                .attr("r", 30)
                .on("dblclick", dblclick)
                .call(drag);

                node.append("image")
                .attr("xlink:href", function (d) {
                    return "images/" + graph.icons[d.type].name + ".svg";
                })
                .attr("x", -8)
                .attr("y", -8)
                .attr("width", 16)
                .attr("height", 16);
            });
        </script>
    </body>
</html>
